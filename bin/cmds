#!/bin/bash
# @desc: run command inside a tmux session named 'CMDLINE'
# if session named 'CMDLINE' already exists, it will use the existing session

function warn() {
	printf "\033[0;33m[Warn]\033[0m %s$1\n"
}

cmd="$1"
name="CMDLINE"
cwd="$(pwd)"

if [[ -z "$cmd" ]]; then
	warn "Please provide a command!"
else
	if [[ -z "$TMUX" ]]; then
		if tmux has-session -t "$name" 2>/dev/null; then
			tmux attach -t "$name" \; \
				send-keys "$cmd" Enter
		else
			tmux new -s "$name" -c "$cwd" \; \
				send-keys -t "$name" "$cmd" Enter
		fi
	else
		if tmux has-session -t "$name" 2>/dev/null; then
			tmux switch-client -t "$name"
		else
			tmux new -s "$name" -d -c "$cwd"
			tmux switch-client -t "$name"
		fi
		tmux send-keys -t "$name" "$cmd" Enter
	fi
fi
