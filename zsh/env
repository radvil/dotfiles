#!/bin/zsh

function regpath() {
	if [[ -z "$1" ]]; then
		warn "PATH : missing argument"
		return 1
	fi
	if [[ ! -d "$1" ]]; then
		warn "PATH: \"$1\" is not a directory"
		return 1
	fi
	if [[ -z "$PATH" ]]; then
		export PATH="$1"
	else
		if [[ ":$PATH:" != *":$1:"* ]]; then
			# echo "adding $1 to PATH"
			export PATH="$1:$PATH"
		fi
		# export path alias
		[[ -n "$2" ]] && export "$2"="$1"
	fi
}

function __setup__() {
  export DOTFILES="$HOME/.dotfiles"
  export BUN_INSTALL="$HOME/.bun" 
  source "$DOTFILES/build/utils.sh"
	# should setup NVM before anything else
	source_file "$HOME/.nvm/nvm.sh" --silent
	source_file "$HOME/.nvm/bash_completion" --silent
	regpath "$BUN_INSTALL/bin" "BUN_BIN"
	regpath "$DOTFILES/bin" "DOTFILES_BIN"
}

function __init__() {
    source_file "$DOTFILES/git/init.zsh" --silent
    source_file "$DOTFILES/omz/init.zsh" --silent
    source_file "$DOTFILES/starship/init.zsh" --silent
    source_file "$DOTFILES/nnn/init.zsh" --silent
    source_file "$DOTFILES/fzf/init.zsh" --silent
    source_file "$DOTFILES/z/init.zsh" --silent
    source_file "$DOTFILES/alias/init.zsh" --silent
}

__setup__
__init__

# bun completions
[ -s "/home/radvil/.bun/_bun" ] && source "/home/radvil/.bun/_bun"
